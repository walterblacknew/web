{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">داشبورد زیبا | پاسخ‌های پرس‌لاین</h1>

<div class="table-responsive">
  <table id="responsesTable" class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Form ID</th>
        <th>Response ID</th>
        <th>Submitted At</th>
        <th>Answers (JSON)</th>
      </tr>
    </thead>
    <tbody>
      {% for item in responses %}
      <tr>
        <td>{{ item.get("form_id", "-") }}</td>
        <td>{{ item.get("response_id", "-") }}</td>
        <td>{{ item.get("submitted_at", "-") }}</td>
        <!-- می‌توانید این بخش را جزئی‌تر نمایش دهید -->
        <td>
          <pre class="m-0">{{ item.get("answers") | tojson(indent=2) }}</pre>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  $(document).ready(function() {
    // ایجاد DataTable
    let table = $('#responsesTable').DataTable({
      paging: true,
      searching: true,
      info: true,
      language: {
        "search": "جستجو:",
        "lengthMenu": "نمایش _MENU_ ردیف",
        "info": "نمایش _START_ تا _END_ از _TOTAL_ مورد",
        "infoEmpty": "هیچ موردی یافت نشد",
        "infoFiltered": "(فیلتر شده از _MAX_ مورد)",
        "paginate": {
          "previous": "قبلی",
          "next": "بعدی"
        }
      }
    });
    
    // افزودن یک جعبه جستجو برای هر ستون در هدر جدول
    // (در DataTables معمولاً از روش append کردن input به each th استفاده می‌شود)
    $('#responsesTable thead th').each(function () {
      var title = $(this).text();
      $(this).append('<br/><input type="text" class="col-search" placeholder="جستجو در '+title+'" />');
    });
    
    // اعمال جستجو در ستون به ستون
    table.columns().every(function () {
      var that = this;
      $('input', this.header()).on('keyup change', function () {
        if (that.search() !== this.value) {
          that.search(this.value).draw();
        }
      });
    });
  });
</script>
{% endblock %}
